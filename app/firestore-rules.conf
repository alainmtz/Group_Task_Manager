rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // MODO DE PRUEBA: Permite lectura/escritura por 30 días
    // Válido hasta: 11 de diciembre de 2025
    match /{document=**} {
      allow read, write: if request.time < timestamp.date(2025, 12, 11);
    }
    match /b/{bucket}/o {
    // Test rules: Allow authenticated users to upload and read images
    match /avatars/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    match /chat-images/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // Deny all other paths for safety
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}

/* 
 * REGLAS DE PRODUCCIÓN (usa estas después del testing):
 * 
 * rules_version = '2';
 * service cloud.firestore {
 *   match /databases/{database}/documents {
 *     
 *     // Helper function: verificar si el usuario está autenticado
 *     function isAuthenticated() {
 *       return request.auth != null;
 *     }
 *     
 *     // Helper function: verificar si el usuario es miembro de un grupo
 *     function isMember(groupId) {
 *       return isAuthenticated() && 
 *              request.auth.uid in get(/databases/$(database)/documents/groups/$(groupId)).data.members;
 *     }
 *     
 *     // Helper function: verificar si el usuario es el dueño del grupo
 *     function isOwner(groupId) {
 *       return isAuthenticated() && 
 *              request.auth.uid == get(/databases/$(database)/documents/groups/$(groupId)).data.ownerId;
 *     }
 *     
 *     // Reglas para usuarios
 *     match /users/{userId} {
 *       // Los usuarios pueden leer y escribir solo su propia información
 *       allow read, write: if isAuthenticated();
 *     }
 *     
 *     // Reglas para grupos
 *     match /groups/{groupId} {
 *       // Leer: solo los miembros del grupo
 *       allow read: if isMember(groupId);
 *       
 *       // Crear: cualquier usuario autenticado
 *       allow create: if isAuthenticated() &&
 *                       request.resource.data.ownerId == request.auth.uid &&
 *                       request.resource.data.members is list &&
 *                       request.auth.uid in request.resource.data.members;
 *       
 *       // Actualizar: solo el dueño o miembros (para agregar/remover miembros)
 *       allow update: if isOwner(groupId) || isMember(groupId);
 *       
 *       // Eliminar: solo el dueño
 *       allow delete: if isOwner(groupId);
 *       
 *       // Reglas para listas dentro de grupos
 *       match /lists/{listId} {
 *         // Heredan los permisos del grupo padre
 *         allow read, write: if isMember(groupId);
 *         
 *         // Reglas para tareas dentro de listas
 *         match /tasks/{taskId} {
 *           // Heredan los permisos del grupo padre
 *           allow read, write: if isMember(groupId);
 *         }
 *				
 *       }
 *     }
 *   }
 * }
 */
